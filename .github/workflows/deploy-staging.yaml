# name: Deploy VersusAI to EC2 (Staging)

on:
  push:
    branches:
      - staging
jobs:
  build-and-push-laravel:
    name: Build & Push Laravel Docker Image
    runs-on: ubuntu-latest
# on:
#   push:
#     branches:
#       - staging

# jobs:
#   build-and-push-laravel:
#     name: Build & Push Laravel Docker Image
#     runs-on: ubuntu-latest

#     steps:
#       - name: Checkout Repository
#         uses: actions/checkout@v3

#       - name: Run Laravel Tests
#         working-directory: ./server
#         run: php artisan test

#       - name: Login to Docker Hub
#         uses: docker/login-action@v3
#         with:
#           username: ${{ secrets.DOCKER_USERNAME }}
#           password: ${{ secrets.DOCKER_TOKEN }}

#       - name: Build Laravel Docker Image
#         run: docker build -t ${{ secrets.DOCKER_USERNAME }}/versusai-laravel:staging ./server

#       - name: Push Laravel Docker Image
#         run: docker push ${{ secrets.DOCKER_USERNAME }}/versusai-laravel:staging

#   build-and-push-nextjs:
#     name: Build & Push Next.js Docker Image
#     runs-on: ubuntu-latest

#     steps:
#       - name: Checkout Repository
#         uses: actions/checkout@v3

#       - name: Set up Node.js
#         uses: actions/setup-node@v3
#         with:
#           node-version: 20

#       - name: Install Dependencies
#         working-directory: ./client
#         run: npm install

#       - name: Login to Docker Hub
#         uses: docker/login-action@v3
#         with:
#           username: ${{ secrets.DOCKER_USERNAME }}
#           password: ${{ secrets.DOCKER_TOKEN }}

#       - name: Build Next.js Docker Image
#         run: docker build -t ${{ secrets.DOCKER_USERNAME }}/versusai-nextjs:staging ./client

#       - name: Push Next.js Docker Image
#         run: docker push ${{ secrets.DOCKER_USERNAME }}/versusai-nextjs:staging

#   deploy-to-ec2:
#     name: Deploy to EC2 (Staging)
#     needs: [build-and-push-laravel, build-and-push-nextjs]
#     runs-on: ubuntu-latest

#     steps:
#       - name: Checkout Repository
#         uses: actions/checkout@v3

#       - name: Deploy via SSH
#         uses: appleboy/ssh-action@v1
#         with:
#           host: ${{ secrets.EC2_HOST_STAGING }}
#           username: ${{ secrets.EC2_USER }}
#           key: ${{ secrets.EC2_KEY }}
#           script: |
#             docker-compose down
#             docker rmi ${{ secrets.DOCKER_USERNAME }}/versusai-laravel:staging || true
#             docker rmi ${{ secrets.DOCKER_USERNAME }}/versusai-nextjs:staging || true
#             docker-compose up -d
